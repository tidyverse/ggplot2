---
title: "Introduction to ggplot2"
output: rmarkdown::html_vignette
description: |
  An overview of the layered grammar of graphics.
vignette: >
  %\VignetteIndexEntry{Introduction to ggplot2}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>"
)
```

ggplot2 is an R package for producing visualizations of data. 
Unlike many graphics packages, ggplot2 uses a conceptual framework based on the grammar of graphics.
This allows you to 'speak' a graph from composable elements, instead of being limited to a predefined set of charts. 

While more complete information about how to use ggplot2 can be found in the [book](https://ggplot2-book.org/), a brief overview of the plot components and some terse examples can be found here. For structure, we go over the 7 composable parts that come together as a set of instructions on how to draw a chart.

```{r overview_graphic, echo=FALSE}
library(ggplot2)
n <- 7
x <- outer(c(-2, 0, 2, 0), rep(1, n))
y <- outer(c(0, 1, 0, -1), seq(0, 2.309, length.out = n), FUN = `+`)

df <- data.frame(
  x = as.vector(x),
  y = as.vector(y),
  group = as.vector(col(x))
)

ggplot(df, aes(x, y, group = group, fill = factor(group))) +
  geom_polygon(alpha = 0.9) +
  coord_equal() +
  scale_y_continuous(
    breaks = seq(0, 2.309, length.out = n),
    labels = c("Data", "Mapping", "Layers", "Scales",
               "Facets", "Coordinates", "Theme")
  ) +
  scale_fill_manual(
    values = c("#E69F00", "#56B4E9", "#009E73", "#F0E442",
               "#0072B2", "#D55E00", "#CC79A7"),
    guide = "none"
  ) +
  theme_void() +
  theme(axis.text.y = element_text(face = "bold", hjust = 1))

```

Out of these components, ggplot2 needs at least the following three to produce a chart: data, a mapping and a layer. The scales, facets, coordinates and theme have sensible defaults that take away a lot of finicky work.

## Data

As the foundation of every graphic, ggplot2 uses [data](https://ggplot2-book.org/getting-started.html#fuel-economy-data) to construct a plot. 
The system works best if the data is provided in a [tidy](https://tidyr.tidyverse.org/articles/tidy-data.html) format, which briefly means a rectangular data frame structure where rows are observations and columns are variables.

As the first step in many plots, you would pass the data to the `ggplot()` function, which stores the data to be used later by other parts of the plotting system. For example, if we intent to make a graphic about the `mtcars` dataset, we would start as follows:

```{r example_data, fig.show='hide'}
library(ggplot2)

ggplot(mpg)
```

## Mapping

The [mapping](https://ggplot2-book.org/getting-started.html#aesthetics) of a plot is a set of instructions on how parts of the data are mapped onto aesthetic attributes of geometric objects. It allows any tidy data to be understood by the graphics system.

A mapping can be made by using the `aes()` function to make pairs of graphical attributes and parts of the data.
If we want the `displ` and `hwy` columns to be displayed as the x- and y-coordinates in the plot, we can do that as follows:

```{r example_mapping, fig.show='hide'}
ggplot(mpg) +
  aes(x = displ, y = hwy)
```

## Layers

The heart of any graphic are the [layers](https://ggplot2-book.org/toolbox.html). They take the mapped data and display it in something humans can understand as a representation of the data. 
Every layer consists of three important parts:

1. The [**geometry**](https://ggplot2-book.org/individual-geoms.html) that determines *how* data are displayed, such as points, lines or rectangles.
1. The [**statistical transformation**](https://ggplot2-book.org/statistical-summaries.html) that may compute new variables from the data and affect *what* of the data is displayed.
1. The [**position adjustment**](https://ggplot2-book.org/layers.html#position) that primarily determines *where* a piece of data is being displayed.

A layer can be constructed using the `geom_*()` and `stat_*()` functions. These functions often determine one of the three parts of a layer, while the other two can still be specified. Here is how we can use layers to display the `displ` and `hwy` columns of the `mpg` dataset.

```{r example_layer, fig.show='hold'}
# To display a scatterplot
ggplot(mpg) +
  aes(x = displ, y = hwy) +
  geom_point()

# To fit a loess trendline to the data
ggplot(mpg) +
  aes(x = displ, y = hwy) +
  stat_smooth(formula = y ~ x, method = "loess")
```

## Scales

[Scales](https://ggplot2-book.org/scales-guides.html) are important for translating what is shown on the graph back to an understanding of the data. The scales typically form pairs with aesthetic attributes of the plots, and are represented in plots by guides, like axes or legends.
Scales are responsible for updating the limits of a plot, setting the breaks, formatting the labels and possibly applying a transformation.

To use scales, one can use one of the scale functions that are patterned as `scale_{aesthetic}_{type}()` functions, where `{aesthetic}` is one of the pairings made in the mapping part of a plot. To map the `class` column in the `mpg` dataset to the viridis colour palette, we can write the following:

```{r example_scales}
ggplot(mpg) +
  aes(x = displ, y = hwy, colour = class) +
  geom_point() +
  scale_colour_viridis_d()
```

## Facets

[Facets](https://ggplot2-book.org/facet.html) can be used to separate small multiples, or different subsets of the data. 
It is a powerful tool to quickly split up the data into smaller panels to look for meaning among the subsets.
In addition, the layout can convey a pattern because more than one variable may be used to split the data.

The facets have their own mapping that can be given to the `vars()` function. 
To show the `mpg` dataset by the `drv` and `year` columns, we can use `facet_grid()` as follows:

```{r example_facets}
ggplot(mpg) +
  aes(x = displ, y = hwy) +
  geom_point() +
  facet_grid(rows = vars(year), cols = vars(drv))
```

## Coordinates

You can view the [coordinates](https://ggplot2-book.org/coord.html) part of the plot as an interpreter of positional aesthetics. 
While typically Cartesian coordinates are used, the coordinate system powers the display of [map](https://ggplot2-book.org/maps.html) projections and [polar](https://ggplot2-book.org/coord.html#polar-coordinates-with-coord_polar) plots.

To show the `mpg` dataset in polar coordinates instead of Cartesian ones, one can use `coord_polar()` to determine what should be mapped to the angle (theta) or radius.

```{r example_coords}
ggplot(mpg) +
  aes(x = displ, y = hwy) +
  geom_point() +
  coord_polar(theta = "y")
```

## Theme

The [theme](https://ggplot2-book.org/polishing.html) system controls almost any visuals of the plot that are not controlled by the data, and is therefor important for the look and feel of the plot. You can use the theme for things ranging from determining the location of the legends to setting the horizontal text adjustment for the bottom x axis specifically. Many elements in the theme are hierarchical in that setting the look of the general axis line affects those of the bottom and left axes simultaneously. 

To tweak the visuals of the plot, one can use many of the built-in `theme_*()` functions and/or detail specific aspects with the `theme()` function. The `element_*()` functions control the graphical attributes of theme parts.

```{r example_theme}
ggplot(mpg) +
  aes(x = displ, y = hwy, colour = class) +
  geom_point() +
  theme_minimal() +
  theme(
    legend.position = "top",
    axis.line = element_line(linewidth = 0.75),
    axis.line.x.bottom = element_line(colour = "blue")
  )
```
