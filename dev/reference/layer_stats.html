<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Layer statistical transformations — layer_stats • ggplot2</title><!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png"><link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png"><link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png"><link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png"><link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png"><link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png"><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/Source_Sans_Pro-0.4.9/font.css" rel="stylesheet"><link href="../deps/Source_Code_Pro-0.4.9/font.css" rel="stylesheet"><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Layer statistical transformations — layer_stats"><meta name="description" content="In ggplot2, a plot is constructed by adding layers to it. A layer consists
of two important parts: the geometry (geoms), and statistical transformations
(stats). The 'stat' part of a layer is important because it performs a
computation on the data before it is displayed. Stats determine what is
displayed, not how it is displayed.
For example, if you add stat_density() to a plot, a kernel density
estimation is performed, which can be displayed with the 'geom' part of a
layer. For many geom_*() functions, stat_identity() is used,
which performs no extra computation on the data."><meta property="og:description" content="In ggplot2, a plot is constructed by adding layers to it. A layer consists
of two important parts: the geometry (geoms), and statistical transformations
(stats). The 'stat' part of a layer is important because it performs a
computation on the data before it is displayed. Stats determine what is
displayed, not how it is displayed.
For example, if you add stat_density() to a plot, a kernel density
estimation is performed, which can be displayed with the 'geom' part of a
layer. For many geom_*() functions, stat_identity() is used,
which performs no extra computation on the data."><meta property="og:image" content="https://ggplot2.tidyverse.org/logo.png"><meta name="robots" content="noindex"><script defer data-domain="ggplot2.tidyverse.org,all.tidyverse.org" src="https://plausible.io/js/plausible.js"></script></head><body>
    <a href="#container" class="visually-hidden-focusable">Skip to content</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-none" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">ggplot2</a>

    <small class="nav-text text-danger me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="In-development version">3.5.1.9000</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="nav-item"><a class="nav-link" href="../articles/ggplot2.html">Get started</a></li>
<li class="active nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-news" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">News</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-news"><li><h6 class="dropdown-header" data-toc-skip>Releases</h6></li>
    <li><a class="external-link dropdown-item" href="https://www.tidyverse.org/blog/2024/02/ggplot2-3-5-0/">Version 3.5.0</a></li>
    <li><a class="external-link dropdown-item" href="https://www.tidyverse.org/blog/2022/11/ggplot2-3-4-0/">Version 3.4.0</a></li>
    <li><a class="external-link dropdown-item" href="https://www.tidyverse.org/blog/2020/03/ggplot2-3-3-0/">Version 3.3.0</a></li>
    <li><a class="external-link dropdown-item" href="https://www.tidyverse.org/articles/2019/06/ggplot2-3-2-0/">Version 3.2.0</a></li>
    <li><a class="external-link dropdown-item" href="https://www.tidyverse.org/articles/2018/10/ggplot2-3-1-0/">Version 3.1.0</a></li>
    <li><a class="external-link dropdown-item" href="https://www.tidyverse.org/articles/2018/07/ggplot2-3-0-0/">Version 3.0.0</a></li>
    <li><a class="external-link dropdown-item" href="https://posit.co/blog/ggplot2-2-2-0/">Version 2.2.0</a></li>
    <li><a class="external-link dropdown-item" href="https://posit.co/blog/ggplot2-2-1-0/">Version 2.1.0</a></li>
    <li><a class="external-link dropdown-item" href="https://posit.co/blog/ggplot2-2-0-0/">Version 2.0.0</a></li>
    <li><a class="external-link dropdown-item" href="https://posit.co/blog/ggplot2-updates/">Version 1.0.0</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><a class="dropdown-item" href="../news/index.html">Changelog</a></li>
  </ul></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles"><li><a class="dropdown-item" href="../articles/ggplot2-specs.html">Aesthetic specifications</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>Developer</h6></li>
    <li><a class="dropdown-item" href="../articles/extending-ggplot2.html">Extending ggplot2</a></li>
    <li><a class="dropdown-item" href="../articles/ggplot2-in-packages.html">Using ggplot2 in packages</a></li>
    <li><a class="dropdown-item" href="../articles/profiling.html">Profiling Performance</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>FAQ</h6></li>
    <li><a class="dropdown-item" href="../articles/faq-axes.html">FAQ: Axes</a></li>
    <li><a class="dropdown-item" href="../articles/faq-faceting.html">FAQ: Faceting</a></li>
    <li><a class="dropdown-item" href="../articles/faq-customising.html">FAQ: Customising</a></li>
    <li><a class="dropdown-item" href="../articles/faq-annotation.html">FAQ: Annotation</a></li>
    <li><a class="dropdown-item" href="../articles/faq-reordering.html">FAQ: Reordering</a></li>
    <li><a class="dropdown-item" href="../articles/faq-bars.html">FAQ: Barplots</a></li>
  </ul></li>
<li class="nav-item"><a class="external-link nav-link" href="https://exts.ggplot2.tidyverse.org/gallery/">Extensions</a></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json"></form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/tidyverse/ggplot2/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic" id="container">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Layer statistical transformations</h1>
      <small class="dont-index">Source: <a href="https://github.com/tidyverse/ggplot2/blob/main/R/docs_layer.R" class="external-link"><code>R/docs_layer.R</code></a></small>
      <div class="d-none name"><code>layer_stats.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>In ggplot2, a plot is constructed by adding layers to it. A layer consists
of two important parts: the geometry (geoms), and statistical transformations
(stats). The 'stat' part of a layer is important because it performs a
computation on the data before it is displayed. Stats determine <em>what</em> is
displayed, not <em>how</em> it is displayed.</p>
<p>For example, if you add <code><a href="geom_density.html">stat_density()</a></code> to a plot, a kernel density
estimation is performed, which can be displayed with the 'geom' part of a
layer. For many <code>geom_*()</code> functions, <code><a href="stat_identity.html">stat_identity()</a></code> is used,
which performs no extra computation on the data.</p>
    </div>


    <div class="section level2">
    <h2 id="specifying-stats">Specifying stats<a class="anchor" aria-label="anchor" href="#specifying-stats"></a></h2>
    <p>There are five ways in which the 'stat' part of a layer can be specified.</p>
<p></p><div class="sourceCode r"><pre><code><span><span class="co"># 1. The stat can have a layer constructor</span></span>
<span><span class="fu"><a href="../reference/geom_density.html">stat_density</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># 2. A geom can default to a particular stat</span></span>
<span><span class="fu"><a href="../reference/geom_density.html">geom_density</a></span><span class="op">(</span><span class="op">)</span> <span class="co"># has `stat = "density"` as default</span></span>
<span></span>
<span><span class="co"># 3. It can be given to a geom as a string</span></span>
<span><span class="fu"><a href="../reference/geom_path.html">geom_line</a></span><span class="op">(</span>stat <span class="op">=</span> <span class="st">"density"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># 4. The ggproto object of a stat can be given</span></span>
<span><span class="fu"><a href="../reference/geom_ribbon.html">geom_area</a></span><span class="op">(</span>stat <span class="op">=</span> <span class="va">StatDensity</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># 5. It can be given to `layer()` directly:</span></span>
<span><span class="fu"><a href="../reference/layer.html">layer</a></span><span class="op">(</span></span>
<span>  geom <span class="op">=</span> <span class="st">"line"</span>,</span>
<span>  stat <span class="op">=</span> <span class="st">"density"</span>,</span>
<span>  position <span class="op">=</span> <span class="st">"identity"</span></span>
<span><span class="op">)</span></span></code></pre><p></p></div>
<p>Many of these ways are absolutely equivalent. Using
<code>stat_density(geom = "line")</code> is identical to using
<code>geom_line(stat = "density")</code>. Note that for <code><a href="layer.html">layer()</a></code>, you need to
provide the <code>"position"</code> argument as well. To give stats as a string, take
the function name, and remove the <code>stat_</code> prefix, such that <code>stat_bin</code>
becomes <code>"bin"</code>.</p>
<p>Some of the more well known stats that can be used for the <code>stat</code> argument
are: <code><a href="geom_density.html">"density"</a></code>, <code><a href="geom_histogram.html">"bin"</a></code>,
<code><a href="geom_bar.html">"count"</a></code>, <code><a href="geom_function.html">"function"</a></code> and
<code><a href="geom_smooth.html">"smooth"</a></code>.</p>
    </div>
    <div class="section level2">
    <h2 id="paired-geoms-and-stats">Paired geoms and stats<a class="anchor" aria-label="anchor" href="#paired-geoms-and-stats"></a></h2>
    <p>Some geoms have paired stats. In some cases, like <code><a href="geom_density.html">geom_density()</a></code>, it is
just a variant of another geom, <code><a href="geom_ribbon.html">geom_area()</a></code>, with slightly different
defaults.</p>
<p>In other cases, the relationship is more complex. In the case of boxplots for
example, the stat and the geom have distinct roles. The role of the stat is
to compute the five-number summary of the data. In addition to just
displaying the box of the five-number summary, the geom also provides display
options for the outliers and widths of boxplots. In such cases, you cannot
freely exchange geoms and stats: using <code>stat_boxplot(geom = "line")</code> or
<code>geom_area(stat = "boxplot")</code> give errors.</p>
<p>Some stats and geoms that are paired are:</p><ul><li><p><code><a href="geom_violin.html">geom_violin()</a></code> and <code><a href="geom_violin.html">stat_ydensity()</a></code></p></li>
<li><p><code><a href="geom_histogram.html">geom_histogram()</a></code> and <code><a href="geom_histogram.html">stat_bin()</a></code></p></li>
<li><p><code><a href="geom_contour.html">geom_contour()</a></code> and <code><a href="geom_contour.html">stat_contour()</a></code></p></li>
<li><p><code><a href="geom_function.html">geom_function()</a></code> and <code><a href="geom_function.html">stat_function()</a></code></p></li>
<li><p><code><a href="geom_bin_2d.html">geom_bin_2d()</a></code> and <code><a href="geom_bin_2d.html">stat_bin_2d()</a></code></p></li>
<li><p><code><a href="geom_boxplot.html">geom_boxplot()</a></code> and <code><a href="geom_boxplot.html">stat_boxplot()</a></code></p></li>
<li><p><code><a href="geom_count.html">geom_count()</a></code> and <code><a href="geom_count.html">stat_sum()</a></code></p></li>
<li><p><code><a href="geom_density.html">geom_density()</a></code> and <code><a href="geom_density.html">stat_density()</a></code></p></li>
<li><p><code><a href="geom_density_2d.html">geom_density_2d()</a></code> and <code><a href="geom_density_2d.html">stat_density_2d()</a></code></p></li>
<li><p><code><a href="geom_hex.html">geom_hex()</a></code> and <code><a href="geom_hex.html">stat_binhex()</a></code></p></li>
<li><p><code><a href="geom_quantile.html">geom_quantile()</a></code> and <code><a href="geom_quantile.html">stat_quantile()</a></code></p></li>
<li><p><code><a href="geom_smooth.html">geom_smooth()</a></code> and <code><a href="geom_smooth.html">stat_smooth()</a></code></p></li>
</ul></div>
    <div class="section level2">
    <h2 id="using-computed-variables">Using computed variables<a class="anchor" aria-label="anchor" href="#using-computed-variables"></a></h2>
    <p>As mentioned above, the role of stats is to perform computation on the data.
As a result, stats have 'computed variables' that determine compatibility
with geoms. These computed variables are documented in the
<strong>Computed variables</strong> sections of the documentation, for example in
<code><a href="geom_histogram.html">?stat_bin</a></code>. While more thoroughly documented
in <code><a href="aes_eval.html">after_stat()</a></code>, it should briefly be mentioned that these computed stats
can be accessed in <code><a href="aes.html">aes()</a></code>.</p>
<p>For example, the <code><a href="geom_density.html">?stat_density</a></code> documentation states that,
in addition to a variable called <code>density</code>, the stat computes a variable
named <code>count</code>. Instead of scaling such that the area integrates to 1, the
<code>count</code> variable scales the computed density such that the values
can be interpreted as counts. If <code>stat_density(aes(y = after_stat(count)))</code>
is used, we can display these count-scaled densities instead of the regular
densities.</p>
<p>The computed variables offer flexibility in that arbitrary geom-stat pairings
can be made. While not necessarily recommended, <code><a href="geom_path.html">geom_line()</a></code> <em>can</em> be paired
with <code>stat = "boxplot"</code> if the line is instructed on how to use the boxplot
computed variables:</p>
<p></p><div class="sourceCode r"><pre><code><span><span class="fu"><a href="../reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">mpg</span>, <span class="fu"><a href="../reference/aes.html">aes</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">cyl</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="../reference/geom_path.html">geom_line</a></span><span class="op">(</span></span>
<span>    <span class="co"># Stage gives 'displ' to the stat, and afterwards chooses 'middle' as</span></span>
<span>    <span class="co"># the y-variable to display</span></span>
<span>    <span class="fu"><a href="../reference/aes.html">aes</a></span><span class="op">(</span>y <span class="op">=</span> <span class="fu"><a href="../reference/aes_eval.html">stage</a></span><span class="op">(</span><span class="va">displ</span>, after_stat <span class="op">=</span> <span class="va">middle</span><span class="op">)</span>,</span>
<span>        <span class="co"># Regroup after computing the stats to display a single line</span></span>
<span>        group <span class="op">=</span> <span class="fu"><a href="../reference/aes_eval.html">after_stat</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span><span class="op">)</span>,</span>
<span>    stat <span class="op">=</span> <span class="st">"boxplot"</span></span>
<span>  <span class="op">)</span></span></code></pre><p></p></div>
    </div>
    <div class="section level2">
    <h2 id="under-the-hood">Under the hood<a class="anchor" aria-label="anchor" href="#under-the-hood"></a></h2>
    <p>Internally, stats are represented as <code><a href="ggproto.html">ggproto</a></code> classes that
occupy a slot in a layer. All these classes inherit from the parental
<code><a href="ggplot2-ggproto.html">Stat</a></code> ggproto object that orchestrates how stats work. Briefly, stats
are given the opportunity to perform computation either on the layer as a
whole, a facet panel, or on individual groups. For more information on
extending stats, see the <strong>Creating a new stat</strong> section after
running <code><a href="../articles/extending-ggplot2.html">vignette("extending-ggplot2")</a></code>. Additionally, see the <strong>New stats</strong>
section of the
<a href="https://ggplot2-book.org/extensions.html#new-stats" class="external-link">online book</a>.</p>
    </div>
    <div class="section level2">
    <h2 id="see-also">See also<a class="anchor" aria-label="anchor" href="#see-also"></a></h2>
    <div class="dont-index"><p>For an overview of all stat layers, see the
<a href="https://ggplot2.tidyverse.org/reference/index.html#stats">online reference</a>.</p>
<p>How <a href="aes_eval.html">computed aesthetics</a> work.</p>
<p>Other layer documentation:
<code><a href="layer.html">layer</a>()</code>,
<code><a href="layer_geoms.html">layer_geoms</a></code>,
<code><a href="layer_positions.html">layer_positions</a></code></p></div>
    </div>

  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


   </div>
  <footer><div class="container">
  <div class="pkgdown-footer-left">
  <p>Developed by <a href="https://hadley.nz" class="external-link">Hadley Wickham</a>, <a href="https://github.com/wch" class="external-link">Winston Chang</a>, <a href="https://github.com/lionel-" class="external-link">Lionel Henry</a>, <a href="https://data-imaginist.com" class="external-link">Thomas Lin Pedersen</a>, Kohske Takahashi, <a href="https://clauswilke.com" class="external-link">Claus Wilke</a>, <a href="https://karawoo.com" class="external-link">Kara Woo</a>, <a href="https://yutani.rbind.io" class="external-link">Hiroaki Yutani</a>, <a href="https://fishandwhistle.net" class="external-link">Dewey Dunnington</a>, Teun van den Brand, <a href="https://www.posit.co" class="external-link"><img src="https://www.tidyverse.org/posit-logo.svg" alt="Posit" height="16" width="62" style="margin-bottom: 3px;"></a>.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

  </div></footer></body></html>

