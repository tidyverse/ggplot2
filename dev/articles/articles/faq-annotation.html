<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>FAQ: Annotation • ggplot2</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../../apple-touch-icon-60x60.png">
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link href="../../tidyverse.css" rel="stylesheet">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../../bootstrap-toc.css">
<script src="../../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.4/clipboard.min.js" integrity="sha256-FiZwavyI2V6+EXO1U+xzLG3IKldpiTFf3153ea9zikQ=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../../pkgdown.css" rel="stylesheet">
<script src="../../pkgdown.js"></script><link href="../../tidyverse-2.css" rel="stylesheet">
<!--optional theme--><link href="../../.css" rel="stylesheet">
<!-- docsearch --><script src="../../docsearch.js"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/docsearch.js/2.6.1/docsearch.min.css" integrity="sha256-QOSRU/ra9ActyXkIBbiIB144aDBdtvXBcNc3OTNuX/Q=" crossorigin="anonymous">
<link href="../../docsearch.css" rel="stylesheet">
<script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/jquery.mark.min.js" integrity="sha256-4HLtjeVgH0eIB3aZ9mLYF6E8oU5chNdjU6p6rrXpl9U=" crossorigin="anonymous"></script><meta property="og:title" content="FAQ: Annotation">
<meta property="og:description" content="ggplot2">
<meta property="og:image" content="https://ggplot2.tidyverse.org/logo.png">
<meta name="twitter:card" content="summary">
<meta name="robots" content="noindex">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--><!-- Global site tag (gtag.js) - Google Analytics --><script async src="https://www.googletagmanager.com/gtag/js?id=UA-115082821-1"></script><script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-115082821-1');
</script>
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>

      <div class="navbar-brand-container">
        <a class="navbar-brand" href="../../index.html">ggplot2</a>
        <div class="info hidden-xs hidden-sm">
          <span class="partof">part of the <a href="https://tidyverse.org">tidyverse</a></span>
          <span class="version version-danger" data-toggle="tooltip" data-placement="bottom" title="In-development version">3.3.5.9000</span>
        </div>
      </div>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav navbar-right">
<li>
  <a href="../../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    News
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li class="dropdown-header">Releases</li>
    <li>
      <a href="https://www.tidyverse.org/blog/2020/03/ggplot2-3-3-0/">Version 3.3.0</a>
    </li>
    <li>
      <a href="https://www.tidyverse.org/articles/2019/06/ggplot2-3-2-0/">Version 3.2.0</a>
    </li>
    <li>
      <a href="https://www.tidyverse.org/articles/2018/10/ggplot2-3-1-0/">Version 3.1.0</a>
    </li>
    <li>
      <a href="https://www.tidyverse.org/articles/2018/07/ggplot2-3-0-0/">Version 3.0.0</a>
    </li>
    <li>
      <a href="https://blog.rstudio.com/2016/11/14/ggplot2-2-2-0/">Version 2.2.0</a>
    </li>
    <li>
      <a href="https://blog.rstudio.com/2016/03/03/ggplot2-2-1-0/">Version 2.1.0</a>
    </li>
    <li>
      <a href="https://blog.rstudio.com/2015/12/21/ggplot2-2-0-0/">Version 2.0.0</a>
    </li>
    <li>
      <a href="https://blog.rstudio.com/2015/01/09/ggplot2-updates/">Version 1.0.0</a>
    </li>
    <li class="divider">
    <li>
      <a href="../../news/index.html">Changelog</a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../../articles/ggplot2-specs.html">Aesthetic specifications</a>
    </li>
    <li class="divider">
    <li class="dropdown-header">Developer</li>
    <li>
      <a href="../../articles/extending-ggplot2.html">Extending ggplot2</a>
    </li>
    <li>
      <a href="../../articles/ggplot2-in-packages.html">Using ggplot2 in packages</a>
    </li>
    <li>
      <a href="../../articles/profiling.html">Profiling Performance</a>
    </li>
    <li class="divider">
    <li class="dropdown-header">FAQ</li>
    <li>
      <a href="../../articles/articles/faq-axes.html">FAQ: Axes</a>
    </li>
    <li>
      <a href="../../articles/articles/faq-faceting.html">FAQ: Faceting</a>
    </li>
    <li>
      <a href="../../articles/articles/faq-customising.html">FAQ: Customising</a>
    </li>
    <li>
      <a href="../../articles/articles/faq-annotation.html">FAQ: Annotation</a>
    </li>
    <li>
      <a href="../../articles/articles/faq-reordering.html">FAQ: Reordering</a>
    </li>
    <li>
      <a href="../../articles/articles/faq-bars.html">FAQ: Barplots</a>
    </li>
  </ul>
</li>
<li>
  <a href="https://exts.ggplot2.tidyverse.org/gallery/">Extensions</a>
</li>
<li>
  <a href="https://github.com/tidyverse/ggplot2/">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
<form class="navbar-form navbar-right" role="search">
        <div class="form-group">
          <input type="search" class="form-control" name="search-input" id="search-input" placeholder="Search..." aria-label="Search for..." autocomplete="off">
</div>
      </form>
      
    </div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="faq-annotation_files/accessible-code-block-0.0.1/empty-anchor.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>FAQ: Annotation</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/tidyverse/ggplot2/blob/master/vignettes/articles/faq-annotation.Rmd"><code>vignettes/articles/faq-annotation.Rmd</code></a></small>
      <div class="hidden name"><code>faq-annotation.Rmd</code></div>

    </div>

    
    
<style>
  .content h3 {
    margin-top: -30px !important;
  }
  
  details {
    margin-bottom: 40px;
  }
</style>
<div id="why-is-annotation-created-with-geom_text-pixellated-how-can-i-make-it-more-crisp" class="section level3">
<h3 class="hasAnchor">
<a href="#why-is-annotation-created-with-geom_text-pixellated-how-can-i-make-it-more-crisp" class="anchor"></a>Why is annotation created with <code>geom_text()</code> pixellated? How can I make it more crisp?</h3>
<p>You should use <code><a href="../../reference/annotate.html">annotate(geom = "text")</a></code> instead of <code><a href="../../reference/geom_label.html">geom_text()</a></code> for annotation.</p>
<details><p><summary>See example</summary></p>
<p>In the following visualisation we have annotated a histogram with a red line and red text to mark the mean. Note that both the line and the text appears pixellated/fuzzy.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">mean_hwy</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html">round</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">mpg</span><span class="op">$</span><span class="va">hwy</span><span class="op">)</span>, <span class="fl">2</span><span class="op">)</span>

<span class="fu"><a href="../../reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">mpg</span>, <span class="fu"><a href="../../reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">hwy</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="../../reference/geom_freqpoly.html">geom_histogram</a></span><span class="op">(</span>binwidth <span class="op">=</span> <span class="fl">2</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="../../reference/geom_segment.html">geom_segment</a></span><span class="op">(</span>
    x <span class="op">=</span> <span class="va">mean_hwy</span>, xend <span class="op">=</span> <span class="va">mean_hwy</span>,
    y <span class="op">=</span> <span class="fl">0</span>, yend <span class="op">=</span> <span class="fl">35</span>,
    color <span class="op">=</span> <span class="st">"red"</span>
  <span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="../../reference/geom_label.html">geom_text</a></span><span class="op">(</span>
    x <span class="op">=</span> <span class="va">mean_hwy</span>, y <span class="op">=</span> <span class="fl">40</span>,
    label <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span><span class="st">"mean\n"</span>, <span class="va">mean_hwy</span><span class="op">)</span>,
    color <span class="op">=</span> <span class="st">"red"</span>
  <span class="op">)</span></code></pre></div>
<p><img src="faq-annotation_files/figure-html/unnamed-chunk-2-1.png" width="80%"></p>
<p>This is because <code><a href="../../reference/geom_label.html">geom_text()</a></code> draws the geom once per each row of the data frame, and plotting these on top of each other. For annotation (as opposed to plotting the data using text as geometric objects to represent each observation) use <code><a href="../../reference/annotate.html">annotate()</a></code> instead.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../../reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">mpg</span>, <span class="fu"><a href="../../reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">hwy</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="../../reference/geom_freqpoly.html">geom_histogram</a></span><span class="op">(</span>binwidth <span class="op">=</span> <span class="fl">2</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="../../reference/annotate.html">annotate</a></span><span class="op">(</span><span class="st">"segment"</span>,
    x <span class="op">=</span> <span class="va">mean_hwy</span>, xend <span class="op">=</span> <span class="va">mean_hwy</span>, y <span class="op">=</span> <span class="fl">0</span>, yend <span class="op">=</span> <span class="fl">35</span>,
    color <span class="op">=</span> <span class="st">"red"</span>
  <span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="../../reference/annotate.html">annotate</a></span><span class="op">(</span><span class="st">"text"</span>,
    x <span class="op">=</span> <span class="va">mean_hwy</span>, y <span class="op">=</span> <span class="fl">40</span>,
    label <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span><span class="st">"mean ="</span>, <span class="va">mean_hwy</span><span class="op">)</span>,
    color <span class="op">=</span> <span class="st">"red"</span>
  <span class="op">)</span></code></pre></div>
<p><img src="faq-annotation_files/figure-html/unnamed-chunk-3-1.png" width="80%"></p>
</details>
</div>
<div id="how-can-i-make-sure-all-annotation-created-with-geom_text-fits-in-the-bounds-of-the-plot" class="section level3">
<h3 class="hasAnchor">
<a href="#how-can-i-make-sure-all-annotation-created-with-geom_text-fits-in-the-bounds-of-the-plot" class="anchor"></a>How can I make sure all annotation created with <code>geom_text()</code> fits in the bounds of the plot?</h3>
<p>Set <code>vjust = "inward"</code> and <code>hjust = "inward"</code> in <code><a href="../../reference/geom_label.html">geom_text()</a></code>.</p>
<details><p><summary>See example</summary></p>
<p>Suppose you have the following data frame and visualization. The labels at the edges of the plot are cut off slightly.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">df</span> <span class="op">&lt;-</span> <span class="fu">tibble</span><span class="fu">::</span><span class="fu"><a href="https://tibble.tidyverse.org/reference/tribble.html">tribble</a></span><span class="op">(</span>
  <span class="op">~</span><span class="va">x</span>, <span class="op">~</span><span class="va">y</span>, <span class="op">~</span><span class="va">name</span>,
  <span class="fl">2</span>,  <span class="fl">2</span>,  <span class="st">"two"</span>,
  <span class="fl">3</span>,  <span class="fl">3</span>,  <span class="st">"three"</span>,
  <span class="fl">4</span>,  <span class="fl">4</span>,  <span class="st">"four"</span>
<span class="op">)</span>

<span class="fu"><a href="../../reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">df</span>, <span class="fu"><a href="../../reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">x</span>, y <span class="op">=</span> <span class="va">y</span>, label <span class="op">=</span> <span class="va">name</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="../../reference/geom_label.html">geom_text</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">10</span><span class="op">)</span></code></pre></div>
<p><img src="faq-annotation_files/figure-html/unnamed-chunk-4-1.png" width="80%"></p>
<p>You could manually extend axis limits to avoid this, but a more straightforward approach is to set <code>vjust = "inward"</code> and <code>hjust = "inward"</code> in <code><a href="../../reference/geom_label.html">geom_text()</a></code>.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../../reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">df</span>, <span class="fu"><a href="../../reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">x</span>, y <span class="op">=</span> <span class="va">y</span>, label <span class="op">=</span> <span class="va">name</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="../../reference/geom_label.html">geom_text</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">10</span>, vjust <span class="op">=</span> <span class="st">"inward"</span>, hjust <span class="op">=</span> <span class="st">"inward"</span><span class="op">)</span></code></pre></div>
<p><img src="faq-annotation_files/figure-html/unnamed-chunk-5-1.png" width="80%"></p>
</details>
</div>
<div id="how-can-i-annotate-my-bar-plot-to-display-counts-for-each-bar" class="section level3">
<h3 class="hasAnchor">
<a href="#how-can-i-annotate-my-bar-plot-to-display-counts-for-each-bar" class="anchor"></a>How can I annotate my bar plot to display counts for each bar?</h3>
<p>Either calculate the counts ahead of time and place them on bars using <code><a href="../../reference/geom_label.html">geom_text()</a></code> or let <code><a href="../../reference/ggplot.html">ggplot()</a></code> calculate them for you and then add them to the plot using <code>stat_coun()</code> with <code>geom = "text"</code>.</p>
<details><p><summary>See example</summary></p>
<p>Suppose you have the following bar plot and you want to add the number of cars that fall into each <code>drv</code> level on their respective bars.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../../reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">mpg</span>, <span class="fu"><a href="../../reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">drv</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="../../reference/geom_bar.html">geom_bar</a></span><span class="op">(</span><span class="op">)</span></code></pre></div>
<p><img src="faq-annotation_files/figure-html/unnamed-chunk-6-1.png" width="80%"></p>
<p>One option is to calculate the counts with <code><a href="https://dplyr.tidyverse.org/reference/count.html">dplyr::count()</a></code> and then pass them to the <code>label</code> mapping in <code><a href="../../reference/geom_label.html">geom_text()</a></code>. Note that we expanded the y axis limit to get the numbers to fit on the plot.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">mpg</span> <span class="op">%&gt;%</span>
  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/count.html">count</a></span><span class="op">(</span><span class="va">drv</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="../../reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="fu"><a href="../../reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">drv</span>, y <span class="op">=</span> <span class="va">n</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="../../reference/geom_bar.html">geom_col</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="../../reference/geom_label.html">geom_text</a></span><span class="op">(</span><span class="fu"><a href="../../reference/aes.html">aes</a></span><span class="op">(</span>label <span class="op">=</span> <span class="va">n</span><span class="op">)</span>, vjust <span class="op">=</span> <span class="op">-</span><span class="fl">0.5</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="../../reference/coord_cartesian.html">coord_cartesian</a></span><span class="op">(</span>ylim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">110</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p><img src="faq-annotation_files/figure-html/unnamed-chunk-7-1.png" width="80%"></p>
<p>Another option is to let <code><a href="../../reference/ggplot.html">ggplot()</a></code> do the counting for you, and access these counts with <code>..count..</code> that is mapped to the labels to be placed on the plot with <code><a href="../../reference/geom_bar.html">stat_count()</a></code>.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../../reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">mpg</span>, <span class="fu"><a href="../../reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">drv</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="../../reference/geom_bar.html">geom_bar</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu"><a href="../../reference/geom_bar.html">stat_count</a></span><span class="op">(</span>geom <span class="op">=</span> <span class="st">"text"</span>, <span class="fu"><a href="../../reference/aes.html">aes</a></span><span class="op">(</span>label <span class="op">=</span> <span class="va">..count..</span><span class="op">)</span>, vjust <span class="op">=</span> <span class="op">-</span><span class="fl">0.5</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="../../reference/coord_cartesian.html">coord_cartesian</a></span><span class="op">(</span>ylim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">110</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p><img src="faq-annotation_files/figure-html/unnamed-chunk-8-1.png" width="80%"></p>
</details>
</div>
<div id="how-can-i-annotate-my-stacked-bar-plot-to-display-counts-for-each-segment" class="section level3">
<h3 class="hasAnchor">
<a href="#how-can-i-annotate-my-stacked-bar-plot-to-display-counts-for-each-segment" class="anchor"></a>How can I annotate my stacked bar plot to display counts for each segment?</h3>
<p>First calculate the counts for each segment (e.g. with <code><a href="https://dplyr.tidyverse.org/reference/count.html">dplyr::count()</a></code>) and then place them on the bars with <code><a href="../../reference/geom_label.html">geom_text()</a></code> using <code><a href="../../reference/position_stack.html">position_stack(vjust = 0.5)</a></code> in the <code>position</code> argument to place the values in the middle of the segments.</p>
<details><p><summary>See example</summary></p>
<p>Suppose you have the following stacked bar plot.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../../reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">mpg</span>, <span class="fu"><a href="../../reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">class</span>, fill <span class="op">=</span> <span class="va">drv</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="../../reference/geom_bar.html">geom_bar</a></span><span class="op">(</span><span class="op">)</span></code></pre></div>
<p><img src="faq-annotation_files/figure-html/unnamed-chunk-9-1.png" width="80%"></p>
<p>You can first calculate the counts for each segment with <code><a href="https://dplyr.tidyverse.org/reference/count.html">dplyr::count()</a></code>, which will place these values in a column called <code>n</code>.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">mpg</span> <span class="op">%&gt;%</span>
  <span class="fu">count</span><span class="op">(</span><span class="va">class</span>, <span class="va">drv</span><span class="op">)</span> 
<span class="co">#&gt; # A tibble: 12 × 3</span>
<span class="co">#&gt;    class      drv       n</span>
<span class="co">#&gt;    &lt;chr&gt;      &lt;chr&gt; &lt;int&gt;</span>
<span class="co">#&gt;  1 2seater    r         5</span>
<span class="co">#&gt;  2 compact    4        12</span>
<span class="co">#&gt;  3 compact    f        35</span>
<span class="co">#&gt;  4 midsize    4         3</span>
<span class="co">#&gt;  5 midsize    f        38</span>
<span class="co">#&gt;  6 minivan    f        11</span>
<span class="co">#&gt;  7 pickup     4        33</span>
<span class="co">#&gt;  8 subcompact 4         4</span>
<span class="co">#&gt;  9 subcompact f        22</span>
<span class="co">#&gt; 10 subcompact r         9</span>
<span class="co">#&gt; 11 suv        4        51</span>
<span class="co">#&gt; 12 suv        r        11</span></code></pre></div>
<p>You can then pass this result directly to <code><a href="../../reference/ggplot.html">ggplot()</a></code>, draw the segments with appropriate heights with <code>y = n</code> in the <code>aes</code>thetic mapping and <code><a href="../../reference/geom_bar.html">geom_col()</a></code> to draw the bars, and finally place the counts on the plot with <code><a href="../../reference/geom_label.html">geom_text()</a></code>.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">mpg</span> <span class="op">%&gt;%</span>
  <span class="fu">count</span><span class="op">(</span><span class="va">class</span>, <span class="va">drv</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="../../reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="fu"><a href="../../reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">class</span>, fill <span class="op">=</span> <span class="va">drv</span>, y <span class="op">=</span> <span class="va">n</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="../../reference/geom_bar.html">geom_col</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="../../reference/geom_label.html">geom_text</a></span><span class="op">(</span><span class="fu"><a href="../../reference/aes.html">aes</a></span><span class="op">(</span>label <span class="op">=</span> <span class="va">n</span><span class="op">)</span>, size <span class="op">=</span> <span class="fl">3</span>, position <span class="op">=</span> <span class="fu"><a href="../../reference/position_stack.html">position_stack</a></span><span class="op">(</span>vjust <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p><img src="faq-annotation_files/figure-html/unnamed-chunk-11-1.png" width="80%"></p>
</details>
</div>
<div id="how-can-i-display-proportions-relative-frequencies-instead-of-counts-on-a-bar-plot" class="section level3">
<h3 class="hasAnchor">
<a href="#how-can-i-display-proportions-relative-frequencies-instead-of-counts-on-a-bar-plot" class="anchor"></a>How can I display proportions (relative frequencies) instead of counts on a bar plot?</h3>
<p>Either calculate the prpportions ahead of time and place them on bars using <code><a href="../../reference/geom_label.html">geom_text()</a></code> or let <code><a href="../../reference/ggplot.html">ggplot()</a></code> calculate them for you and then add them to the plot using <code>stat_coun()</code> with <code>geom = "text"</code>.</p>
<details><p><summary>See example</summary></p>
<p>Suppose you have the following bar plot but you want to display the proportion of cars that fall into each <code>drv</code> level, instead of the count.</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../../reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">mpg</span>, <span class="fu"><a href="../../reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">drv</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="../../reference/geom_bar.html">geom_bar</a></span><span class="op">(</span><span class="op">)</span></code></pre></div>
<p><img src="faq-annotation_files/figure-html/unnamed-chunk-12-1.png" width="80%"></p>
<p>One option is to calculate the proportions with <code><a href="https://dplyr.tidyverse.org/reference/count.html">dplyr::count()</a></code> and then use <code><a href="../../reference/geom_bar.html">geom_col()</a></code> to draw the bars</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">mpg</span> <span class="op">%&gt;%</span>
  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/count.html">count</a></span><span class="op">(</span><span class="va">drv</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu">mutate</span><span class="op">(</span>prop <span class="op">=</span> <span class="va">n</span> <span class="op">/</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">n</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="../../reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="fu"><a href="../../reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">drv</span>, y <span class="op">=</span> <span class="va">prop</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="../../reference/geom_bar.html">geom_col</a></span><span class="op">(</span><span class="op">)</span></code></pre></div>
<p><img src="faq-annotation_files/figure-html/unnamed-chunk-13-1.png" width="80%"></p>
<p>Another option is to let <code><a href="../../reference/ggplot.html">ggplot()</a></code> do the calculation of proportions for you, and access these counts with <code>..prop..</code>. Note that we also need to the <code>group = 1</code> mapping for this option.</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../../reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">mpg</span>, <span class="fu"><a href="../../reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">drv</span>, y <span class="op">=</span> <span class="va">..prop..</span>, group <span class="op">=</span> <span class="fl">1</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="../../reference/geom_bar.html">geom_bar</a></span><span class="op">(</span><span class="op">)</span></code></pre></div>
<p><img src="faq-annotation_files/figure-html/unnamed-chunk-14-1.png" width="80%"></p>
</details>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

      </div>

</div>



      <footer><div class="tidyverse">
  <p>ggplot2 is a part of the <strong>tidyverse</strong>, an ecosystem of packages designed with common APIs and a shared philosophy. Learn more at <a href="https://tidyverse.org">tidyverse.org</a>.</p>
</div>

<div class="author">
  <p>
    Developed by <a href="http://hadley.nz">Hadley Wickham</a>, <a href="https://github.com/wch">Winston Chang</a>, <a href="https://github.com/lionel-">Lionel Henry</a>, <a href="https://data-imaginist.com">Thomas Lin Pedersen</a>, Kohske Takahashi, <a href="https://clauswilke.com">Claus Wilke</a>, <a href="https://karawoo.com">Kara Woo</a>, <a href="https://yutani.rbind.io">Hiroaki Yutani</a>, <a href="https://fishandwhistle.net">Dewey Dunnington</a>, <a href="https://www.rstudio.com"><img src="https://www.tidyverse.org/rstudio-logo.svg" alt="RStudio" height="24"></a>.
    Site built by <a href="https://pkgdown.r-lib.org">pkgdown</a>.
  </p>
</div>

      </footer>
</div>

  
<script src="https://cdnjs.cloudflare.com/ajax/libs/docsearch.js/2.6.1/docsearch.min.js" integrity="sha256-GKvGqXDznoRYHCwKXGnuchvKSwmx9SRMrZOTh2g4Sb0=" crossorigin="anonymous"></script><script>
  docsearch({
    
    
    apiKey: 'e1261f3df95d2d4704c626ff11a4b536',
    indexName: 'tidyverse_ggplot2',
    inputSelector: 'input#search-input.form-control',
    transformData: function(hits) {
      return hits.map(function (hit) {
        hit.url = updateHitURL(hit);
        return hit;
      });
    }
  });
</script>
</body>
</html>
