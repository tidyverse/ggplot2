<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Using ggplot2 in packages • ggplot2</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/Source_Sans_Pro-0.4.9/font.css" rel="stylesheet">
<link href="../deps/Source_Code_Pro-0.4.9/font.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Using ggplot2 in packages">
<meta name="description" content="Customising how aesthetic specifications are represented on your plot.
">
<meta property="og:description" content="Customising how aesthetic specifications are represented on your plot.
">
<meta property="og:image" content="https://ggplot2.tidyverse.org/logo.png">
<meta name="robots" content="noindex">
<script defer data-domain="ggplot2.tidyverse.org,all.tidyverse.org" src="https://plausible.io/js/plausible.js"></script>
</head>
<body>
    <a href="#container" class="visually-hidden-focusable">Skip to content</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-none" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">ggplot2</a>

    <small class="nav-text text-danger me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="In-development version">3.5.1.9000</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../articles/ggplot2.html">Get started</a></li>
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-news" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">News</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-news">
<li><h6 class="dropdown-header" data-toc-skip>Releases</h6></li>
    <li><a class="external-link dropdown-item" href="https://www.tidyverse.org/blog/2024/02/ggplot2-3-5-0/">Version 3.5.0</a></li>
    <li><a class="external-link dropdown-item" href="https://www.tidyverse.org/blog/2022/11/ggplot2-3-4-0/">Version 3.4.0</a></li>
    <li><a class="external-link dropdown-item" href="https://www.tidyverse.org/blog/2020/03/ggplot2-3-3-0/">Version 3.3.0</a></li>
    <li><a class="external-link dropdown-item" href="https://www.tidyverse.org/articles/2019/06/ggplot2-3-2-0/">Version 3.2.0</a></li>
    <li><a class="external-link dropdown-item" href="https://www.tidyverse.org/articles/2018/10/ggplot2-3-1-0/">Version 3.1.0</a></li>
    <li><a class="external-link dropdown-item" href="https://www.tidyverse.org/articles/2018/07/ggplot2-3-0-0/">Version 3.0.0</a></li>
    <li><a class="external-link dropdown-item" href="https://posit.co/blog/ggplot2-2-2-0/">Version 2.2.0</a></li>
    <li><a class="external-link dropdown-item" href="https://posit.co/blog/ggplot2-2-1-0/">Version 2.1.0</a></li>
    <li><a class="external-link dropdown-item" href="https://posit.co/blog/ggplot2-2-0-0/">Version 2.0.0</a></li>
    <li><a class="external-link dropdown-item" href="https://posit.co/blog/ggplot2-updates/">Version 1.0.0</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><a class="dropdown-item" href="../news/index.html">Changelog</a></li>
  </ul>
</li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/ggplot2-specs.html">Aesthetic specifications</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>Developer</h6></li>
    <li><a class="dropdown-item" href="../articles/extending-ggplot2.html">Extending ggplot2</a></li>
    <li><a class="dropdown-item" href="../articles/ggplot2-in-packages.html">Using ggplot2 in packages</a></li>
    <li><a class="dropdown-item" href="../articles/profiling.html">Profiling Performance</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>FAQ</h6></li>
    <li><a class="dropdown-item" href="../articles/faq-axes.html">FAQ: Axes</a></li>
    <li><a class="dropdown-item" href="../articles/faq-faceting.html">FAQ: Faceting</a></li>
    <li><a class="dropdown-item" href="../articles/faq-customising.html">FAQ: Customising</a></li>
    <li><a class="dropdown-item" href="../articles/faq-annotation.html">FAQ: Annotation</a></li>
    <li><a class="dropdown-item" href="../articles/faq-reordering.html">FAQ: Reordering</a></li>
    <li><a class="dropdown-item" href="../articles/faq-bars.html">FAQ: Barplots</a></li>
  </ul>
</li>
<li class="nav-item"><a class="external-link nav-link" href="https://exts.ggplot2.tidyverse.org/gallery/">Extensions</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/tidyverse/ggplot2/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article" id="container">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Using ggplot2 in packages</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/tidyverse/ggplot2/blob/main/vignettes/ggplot2-in-packages.Rmd" class="external-link"><code>vignettes/ggplot2-in-packages.Rmd</code></a></small>
      <div class="d-none name"><code>ggplot2-in-packages.Rmd</code></div>
    </div>

    
    
<p>This vignette is intended for package developers who use ggplot2
within their package code. As of this writing, this includes over 2,000
packages on CRAN and many more elsewhere! Programming with ggplot2
within a package adds several constraints, particularly if you would
like to submit the package to CRAN. In particular, programming within an
R package changes the way you refer to functions from ggplot2 and how
you use ggplot2’s non-standard evaluation within <code><a href="../reference/aes.html">aes()</a></code> and
<code><a href="../reference/vars.html">vars()</a></code>.</p>
<div class="section level2">
<h2 id="referring-to-ggplot2-functions">Referring to ggplot2 functions<a class="anchor" aria-label="anchor" href="#referring-to-ggplot2-functions"></a>
</h2>
<p>As with any function from another package, you will have to list
ggplot2 in your <code>DESCRIPTION</code> under <code>Imports</code> and
refer to its functions using <code>::</code> (e.g.,
<code>ggplot2::function_name</code>):</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">mpg_drv_summary</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="../reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="fu">ggplot2</span><span class="fu">::</span><span class="va"><a href="../reference/mpg.html">mpg</a></span><span class="op">)</span> <span class="op">+</span> </span>
<span>    <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="../reference/geom_bar.html">geom_bar</a></span><span class="op">(</span><span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="../reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">.data</span><span class="op">$</span><span class="va">drv</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>    <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="../reference/coord_flip.html">coord_flip</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
<p>If you use ggplot2 functions frequently, you may wish to import one
or more functions from ggplot2 into your <code>NAMESPACE</code>. If you
use <a href="https://cran.r-project.org/package=roxygen2" class="external-link">roxygen2</a>,
you can include
<code>#' @importFrom ggplot2 &lt;one or more object names&gt;</code> in
any roxygen comment block (this will not work for datasets like
<code>mpg</code>).</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#' @importFrom ggplot2 ggplot aes geom_bar coord_flip</span></span>
<span><span class="va">mpg_drv_summary</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu"><a href="../reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="fu">ggplot2</span><span class="fu">::</span><span class="va"><a href="../reference/mpg.html">mpg</a></span><span class="op">)</span> <span class="op">+</span> </span>
<span>    <span class="fu"><a href="../reference/geom_bar.html">geom_bar</a></span><span class="op">(</span><span class="fu"><a href="../reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">drv</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>    <span class="fu"><a href="../reference/coord_flip.html">coord_flip</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
<p>Even if you use many ggplot2 functions in your package, it is unwise
to use ggplot2 in <code>Depends</code> or import the entire package into
your <code>NAMESPACE</code> (e.g. with <code>#' @import ggplot2</code>).
Using ggplot2 in <code>Depends</code> will attach ggplot2 when your
package is attached, which includes when your package is tested. This
makes it difficult to ensure that others can use the functions in your
package without attaching it (i.e., using <code>::</code>). Similarly,
importing all 450 of ggplot2’s exported objects into your namespace
makes it difficult to separate the responsibility of your package and
the responsibility of ggplot2, in addition to making it difficult for
readers of your code to figure out where functions are coming from!</p>
</div>
<div class="section level2">
<h2 id="using-aes-and-vars-in-a-package-function">Using <code>aes()</code> and <code>vars()</code> in a package
function<a class="anchor" aria-label="anchor" href="#using-aes-and-vars-in-a-package-function"></a>
</h2>
<p>To create any graphic using ggplot2 you will probably need to use
<code><a href="../reference/aes.html">aes()</a></code> at least once. If your graphic uses facets, you might
be using <code><a href="../reference/vars.html">vars()</a></code> to refer to columns in the plot/layer data.
Both of these functions use non-standard evaluation, so if you try to
use them in a function within a package they will result in a CMD check
note:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">mpg_drv_summary</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu"><a href="../reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="fu">ggplot2</span><span class="fu">::</span><span class="va"><a href="../reference/mpg.html">mpg</a></span><span class="op">)</span> <span class="op">+</span> </span>
<span>    <span class="fu"><a href="../reference/geom_bar.html">geom_bar</a></span><span class="op">(</span><span class="fu"><a href="../reference/aes.html">aes</a></span><span class="op">(</span>y <span class="op">=</span> <span class="va">drv</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>    <span class="fu"><a href="../reference/facet_wrap.html">facet_wrap</a></span><span class="op">(</span><span class="fu"><a href="../reference/vars.html">vars</a></span><span class="op">(</span><span class="va">year</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
<pre><code>N  checking R code for possible problems (2.7s)
   mpg_drv_summary: no visible binding for global variable ‘drv’
   Undefined global functions or variables:
     drv</code></pre>
<p>There are three situations in which you will encounter this
problem:</p>
<ul>
<li>You already know the column name or expression in advance.</li>
<li>You have the column name as a character vector.</li>
<li>The user specifies the column name or expression, and you want your
function to use the same kind of non-standard evaluation used by
<code><a href="../reference/aes.html">aes()</a></code> and <code><a href="../reference/vars.html">vars()</a></code>.</li>
</ul>
<p>If you already know the mapping in advance (like the above example)
you should use the <code>.data</code> pronoun from <a href="https://rlang.r-lib.org/" class="external-link">rlang</a> to make it explicit that you
are referring to the <code>drv</code> in the layer data and not some
other variable named <code>drv</code> (which may or may not exist
elsewhere). To avoid a similar note from the CMD check about
<code>.data</code>, use <code>#' @importFrom rlang .data</code> in any
roxygen code block (typically this should be in the package
documentation as generated by
<code>usethis::use_package_doc()</code>).</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">mpg_drv_summary</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu"><a href="../reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="fu">ggplot2</span><span class="fu">::</span><span class="va"><a href="../reference/mpg.html">mpg</a></span><span class="op">)</span> <span class="op">+</span> </span>
<span>    <span class="fu"><a href="../reference/geom_bar.html">geom_bar</a></span><span class="op">(</span><span class="fu"><a href="../reference/aes.html">aes</a></span><span class="op">(</span>y <span class="op">=</span> <span class="va">.data</span><span class="op">$</span><span class="va">drv</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="../reference/facet_wrap.html">facet_wrap</a></span><span class="op">(</span><span class="fu"><a href="../reference/vars.html">vars</a></span><span class="op">(</span><span class="va">.data</span><span class="op">$</span><span class="va">year</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
<p>If you have the column name as a character vector (e.g.,
<code>col = "drv"</code>), use <code>.data[[col]]</code>:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">col_summary</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">df</span>, <span class="va">col</span>, <span class="va">by</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu"><a href="../reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">df</span><span class="op">)</span> <span class="op">+</span> </span>
<span>    <span class="fu"><a href="../reference/geom_bar.html">geom_bar</a></span><span class="op">(</span><span class="fu"><a href="../reference/aes.html">aes</a></span><span class="op">(</span>y <span class="op">=</span> <span class="va">.data</span><span class="op">[[</span><span class="va">col</span><span class="op">]</span><span class="op">]</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>    <span class="fu"><a href="../reference/facet_wrap.html">facet_wrap</a></span><span class="op">(</span><span class="fu"><a href="../reference/vars.html">vars</a></span><span class="op">(</span><span class="va">.data</span><span class="op">[[</span><span class="va">by</span><span class="op">]</span><span class="op">]</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="fu">col_summary</span><span class="op">(</span><span class="va">mpg</span>, <span class="st">"drv"</span>, <span class="st">"year"</span><span class="op">)</span></span></code></pre></div>
<p>If the column name or expression is supplied by the user, you can
also pass it to <code><a href="../reference/aes.html">aes()</a></code> or <code><a href="../reference/vars.html">vars()</a></code> using
<code>{{ col }}</code>. This tidy eval operator captures the expression
supplied by the user and forwards it to another tidy eval-enabled
function such as <code><a href="../reference/aes.html">aes()</a></code> or <code><a href="../reference/vars.html">vars()</a></code>.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">col_summary</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">df</span>, <span class="va">col</span>, <span class="va">by</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu"><a href="../reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">df</span><span class="op">)</span> <span class="op">+</span> </span>
<span>    <span class="fu"><a href="../reference/geom_bar.html">geom_bar</a></span><span class="op">(</span><span class="fu"><a href="../reference/aes.html">aes</a></span><span class="op">(</span>y <span class="op">=</span> <span class="op">{</span><span class="op">{</span> <span class="va">col</span> <span class="op">}</span><span class="op">}</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>    <span class="fu"><a href="../reference/facet_wrap.html">facet_wrap</a></span><span class="op">(</span><span class="fu"><a href="../reference/vars.html">vars</a></span><span class="op">(</span><span class="op">{</span><span class="op">{</span> <span class="va">by</span> <span class="op">}</span><span class="op">}</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="fu">col_summary</span><span class="op">(</span><span class="va">mpg</span>, <span class="va">drv</span>, <span class="va">year</span><span class="op">)</span></span></code></pre></div>
<p>To summarise:</p>
<ul>
<li>If you know the mapping or facet specification is <code>col</code>
in advance, use <code>aes(.data$col)</code> or
<code>vars(.data$col)</code>.</li>
<li>If <code>col</code> is a variable that contains the column name as a
character vector, use <code>aes(.data[[col]]</code> or
<code>vars(.data[[col]])</code>.</li>
<li>If you would like the behaviour of <code>col</code> to look and feel
like it would within <code><a href="../reference/aes.html">aes()</a></code> and <code><a href="../reference/vars.html">vars()</a></code>, use
<code>aes({{ col }})</code> or <code>vars({{ col }})</code>.</li>
</ul>
<p>You will see a lot of other ways to do this in the wild, but the
syntax we use here is the only one we can guarantee will work in the
future! In particular, don’t use <code><a href="../reference/aes_.html">aes_()</a></code> or
<code><a href="../reference/aes_.html">aes_string()</a></code>, as they are deprecated and may be removed in
a future version. Finally, don’t skip the step of creating a data frame
and a mapping to pass in to <code><a href="../reference/ggplot.html">ggplot()</a></code> or its layers! You
will see other ways of doing this, but these may rely on undocumented
behaviour and can fail in unexpected ways.</p>
</div>
<div class="section level2">
<h2 id="best-practices-for-common-tasks">Best practices for common tasks<a class="anchor" aria-label="anchor" href="#best-practices-for-common-tasks"></a>
</h2>
<div class="section level3">
<h3 id="using-ggplot2-to-visualize-an-object">Using ggplot2 to visualize an object<a class="anchor" aria-label="anchor" href="#using-ggplot2-to-visualize-an-object"></a>
</h3>
<p>ggplot2 is commonly used in packages to visualize objects (e.g., in a
<code><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot()</a></code>-style function). For example, a package might define
an S3 class that represents the probability of various discrete
values:</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">mpg_drv_dist</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/structure.html" class="external-link">structure</a></span><span class="op">(</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span></span>
<span>    <span class="st">"4"</span> <span class="op">=</span> <span class="fl">103</span> <span class="op">/</span> <span class="fl">234</span>,</span>
<span>    <span class="st">"f"</span> <span class="op">=</span> <span class="fl">106</span> <span class="op">/</span> <span class="fl">234</span>,</span>
<span>    <span class="st">"r"</span> <span class="op">=</span> <span class="fl">25</span> <span class="op">/</span> <span class="fl">234</span></span>
<span>  <span class="op">)</span>,</span>
<span>  class <span class="op">=</span> <span class="st">"discrete_distr"</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>Many S3 classes in R have a <code><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot()</a></code> method, but it is
unrealistic to expect that a single <code><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot()</a></code> method can
provide the visualization every one of your users is looking for. It is
useful, however, to provide a <code><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot()</a></code> method as a visual
summary that users can call to understand the essence of an object. To
satisfy all your users, we suggest writing a function that transforms
the object into a data frame (or a <code><a href="https://rdrr.io/r/base/list.html" class="external-link">list()</a></code> of data frames if
your object is more complicated). A good example of this approach is <a href="https://cran.r-project.org/package=ggdendro" class="external-link">ggdendro</a>, which
creates dendrograms using ggplot2 but also computes the data necessary
for users to make their own. For the above example, the function might
look like this:</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">discrete_distr_data</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu">tibble</span><span class="fu">::</span><span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html" class="external-link">tibble</a></span><span class="op">(</span></span>
<span>    value <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span>,</span>
<span>    probability <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="fu">discrete_distr_data</span><span class="op">(</span><span class="va">mpg_drv_dist</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 3 × 2</span></span></span>
<span><span class="co">#&gt;   value probability</span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>       <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> 4           0.440</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span> f           0.453</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span> r           0.107</span></span></code></pre></div>
<p>In general, users of <code><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot()</a></code> call it for its
side-effects: it results in a graphic being displayed. This is different
than the behaviour of a <code><a href="../reference/ggplot.html">ggplot()</a></code>, which is not displayed
unless it is explicitly <code><a href="https://rdrr.io/r/base/print.html" class="external-link">print()</a></code>ed. Because of this, ggplot2
defines its own generic <code><a href="../reference/autoplot.html">autoplot()</a></code>, a call to which is
expected to return a <code><a href="../reference/ggplot.html">ggplot()</a></code> (with no side effects).</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#' @importFrom ggplot2 autoplot</span></span>
<span><span class="va">autoplot.discrete_distr</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">object</span>, <span class="va">...</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">plot_data</span> <span class="op">&lt;-</span> <span class="fu">discrete_distr_data</span><span class="op">(</span><span class="va">object</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="../reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">plot_data</span>, <span class="fu"><a href="../reference/aes.html">aes</a></span><span class="op">(</span><span class="va">.data</span><span class="op">$</span><span class="va">value</span>, <span class="va">.data</span><span class="op">$</span><span class="va">probability</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="../reference/geom_bar.html">geom_col</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="../reference/coord_flip.html">coord_flip</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="../reference/labs.html">labs</a></span><span class="op">(</span>x <span class="op">=</span> <span class="st">"Value"</span>, y <span class="op">=</span> <span class="st">"Probability"</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
<p>Once an <code><a href="../reference/autoplot.html">autoplot()</a></code> method has been defined, a
<code><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot()</a></code> method can then consist of <code><a href="https://rdrr.io/r/base/print.html" class="external-link">print()</a></code>ing
the result of <code><a href="../reference/autoplot.html">autoplot()</a></code>:</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#' @importFrom graphics plot</span></span>
<span><span class="va">plot.discrete_distr</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span>, <span class="va">...</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="fu"><a href="../reference/autoplot.html">autoplot</a></span><span class="op">(</span><span class="va">x</span>, <span class="va">...</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
<p>It is considered bad practice to implement an S3 generic like
<code><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot()</a></code>, or <code><a href="../reference/autoplot.html">autoplot()</a></code> if you don’t own the S3
class, as it makes it hard for the package developer who does have
control over the S3 to implement the method themselves. This shouldn’t
stop you from creating your own functions to visualize these
objects!</p>
</div>
<div class="section level3">
<h3 id="creating-a-new-theme">Creating a new theme<a class="anchor" aria-label="anchor" href="#creating-a-new-theme"></a>
</h3>
<p>When creating a new theme, it’s always good practice to start with an
existing theme (e.g. <code><a href="../reference/ggtheme.html">theme_grey()</a></code>) and then
<code>%+replace%</code> the elements that should be changed. This is the
right strategy even if seemingly all elements are replaced, as not doing
so makes it difficult for us to improve themes by adding new elements.
There are many excellent examples of themes in the <a href="https://cran.r-project.org/package=ggthemes" class="external-link">ggthemes</a>
package.</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#' @importFrom ggplot2 %+replace%</span></span>
<span><span class="va">theme_custom</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">...</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu"><a href="../reference/ggtheme.html">theme_grey</a></span><span class="op">(</span><span class="va">...</span><span class="op">)</span> <span class="op"><a href="../reference/get_theme.html">%+replace%</a></span> </span>
<span>    <span class="fu"><a href="../reference/theme.html">theme</a></span><span class="op">(</span></span>
<span>      panel.border <span class="op">=</span> <span class="fu"><a href="../reference/element.html">element_rect</a></span><span class="op">(</span>linewidth <span class="op">=</span> <span class="fl">1</span>, fill <span class="op">=</span> <span class="cn">NA</span><span class="op">)</span>,</span>
<span>      panel.background <span class="op">=</span> <span class="fu"><a href="../reference/element.html">element_blank</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>      panel.grid <span class="op">=</span> <span class="fu"><a href="../reference/element.html">element_line</a></span><span class="op">(</span>colour <span class="op">=</span> <span class="st">"grey80"</span><span class="op">)</span></span>
<span>    <span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="fu">mpg_drv_summary</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> <span class="fu">theme_custom</span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p>It is important that the theme be calculated after the package is
loaded. If not, the theme object is stored in the compiled bytecode of
the built package, which may or may not align with the installed version
of ggplot2! If your package has a default theme for its visualizations,
the correct way to load it is to have a function that returns the
default theme:</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">default_theme</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu">theme_custom</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="va">mpg_drv_summary2</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu">mpg_drv_summary</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> <span class="fu">default_theme</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="testing-ggplot2-output">Testing ggplot2 output<a class="anchor" aria-label="anchor" href="#testing-ggplot2-output"></a>
</h3>
<p>We suggest testing the output of ggplot2 in using the <a href="https://cran.r-project.org/package=vdiffr" class="external-link">vdiffr</a> package,
which is a tool to manage visual test cases (this is one of the ways we
test ggplot2). If changes in ggplot2 or your code introduce a change in
the visual output of a ggplot, tests will fail when you run them locally
or as part of a Continuous Integration setup. To use vdiffr, make sure
you are using <a href="https://testthat.r-lib.org/" class="external-link">testthat</a> (you
can use <code>usethis::use_testthat()</code> to get started) and add
vdiffr to <code>Suggests</code> in your <code>DESCRIPTION</code>. Then,
use
<code>vdiffr::expect_doppleganger(&lt;name of plot&gt;, &lt;ggplot object&gt;)</code>
to make a test that fails if there are visual changes in
<code>&lt;ggplot object&gt;</code>. However, you should consider whether
visual testing is the best strategy because it adds a dependency on how
ggplot2 performs its rendering which may change between versions. If
extracting the layer data using <code><a href="../reference/ggplot_build.html">get_layer_data()</a></code> and
testing the values directly is possible it is far better as it more
directly test the behaviour of your own code.</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">test_that</span><span class="op">(</span><span class="st">"output of ggplot() is stable"</span>, <span class="op">{</span></span>
<span>  <span class="fu">vdiffr</span><span class="fu">::</span><span class="fu"><a href="https://vdiffr.r-lib.org/reference/expect_doppelganger.html" class="external-link">expect_doppelganger</a></span><span class="op">(</span><span class="st">"A blank plot"</span>, <span class="fu"><a href="../reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="ggplot2-in-suggests">ggplot2 in <code>Suggests</code><a class="anchor" aria-label="anchor" href="#ggplot2-in-suggests"></a>
</h3>
<p>If you use ggplot2 in your package, most likely you will want to list
it under <code>Imports</code>. If you would like to list ggplot2 in
<code>Suggests</code> instead, you will not be able to
<code>#' @importFrom ggplot2 ...</code> (i.e., you must refer to ggplot2
objects using <code>::</code>). If you use infix operators from ggplot2
like <code>%+replace%</code> and you want to keep ggplot2 in
<code>Suggests</code>, you can assign the operator within the function
before it is used:</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">theme_custom</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">...</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">`%+replace%`</span> <span class="op">&lt;-</span> <span class="fu">ggplot2</span><span class="fu">::</span><span class="va">`%+replace%`</span></span>
<span>  </span>
<span>  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="../reference/ggtheme.html">theme_grey</a></span><span class="op">(</span><span class="va">...</span><span class="op">)</span> <span class="op"><a href="../reference/get_theme.html">%+replace%</a></span> </span>
<span>    <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="../reference/theme.html">theme</a></span><span class="op">(</span>panel.background <span class="op">=</span> <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="../reference/element.html">element_blank</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
<p>Generally, if you add a method for a ggplot2 generic like
<code><a href="../reference/autoplot.html">autoplot()</a></code>, ggplot2 should be in <code>Imports</code>. If
for some reason you would like to keep ggplot2 in <code>Suggests</code>,
it is possible to register your generics only if ggplot2 is installed
using <code><a href="https://vctrs.r-lib.org/reference/s3_register.html" class="external-link">vctrs::s3_register()</a></code>. If you do this, you should copy
and paste the source of <code><a href="https://vctrs.r-lib.org/reference/s3_register.html" class="external-link">vctrs::s3_register()</a></code> into your own
package to avoid adding a <a href="https://vctrs.r-lib.org/" class="external-link">vctrs</a>
dependency.</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">.onLoad</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">...</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/ns-load.html" class="external-link">requireNamespace</a></span><span class="op">(</span><span class="st">"ggplot2"</span>, quietly <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="fu">vctrs</span><span class="fu">::</span><span class="fu"><a href="https://vctrs.r-lib.org/reference/s3_register.html" class="external-link">s3_register</a></span><span class="op">(</span><span class="st">"ggplot2::autoplot"</span>, <span class="st">"discrete_distr"</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span><span class="op">}</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="read-more">Read more<a class="anchor" aria-label="anchor" href="#read-more"></a>
</h2>
<p>There are other things to consider when taking on a dependency. <a href="https://www.tidyverse.org/blog/2022/09/playing-on-the-same-team-as-your-dependecy/" class="external-link">This
post</a> goes into detail with many of these using ggplot2 as an example
and is a good read for anyone developing a package using ggplot2.</p>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



   </div>
  <footer><div class="container">
  <div class="pkgdown-footer-left">
  <p>Developed by <a href="https://hadley.nz" class="external-link">Hadley Wickham</a>, <a href="https://github.com/wch" class="external-link">Winston Chang</a>, <a href="https://github.com/lionel-" class="external-link">Lionel Henry</a>, <a href="https://data-imaginist.com" class="external-link">Thomas Lin Pedersen</a>, Kohske Takahashi, <a href="https://clauswilke.com" class="external-link">Claus Wilke</a>, <a href="https://karawoo.com" class="external-link">Kara Woo</a>, <a href="https://yutani.rbind.io" class="external-link">Hiroaki Yutani</a>, <a href="https://fishandwhistle.net" class="external-link">Dewey Dunnington</a>, Teun van den Brand, <a href="https://www.posit.co" class="external-link"><img src="https://www.tidyverse.org/posit-logo.svg" alt="Posit" height="16" width="62" style="margin-bottom: 3px;"></a>.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

  </div></footer>
</body>
</html>
